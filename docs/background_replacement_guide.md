# PipelineèƒŒæ™¯æ›¿æ¢ä½¿ç”¨æŒ‡å—

## ğŸ¨ èƒŒæ™¯æ›¿æ¢æ¦‚è¿°

åœ¨3060 GPU Pipelineä¸­ï¼ŒèƒŒæ™¯æ›¿æ¢æ˜¯æœ€åä¸€æ­¥å…³é”®å¤„ç†ï¼Œå°†æŠ åƒåçš„äººç‰©åˆæˆåˆ°æ–°çš„èƒŒæ™¯ä¸Šï¼Œå®ç°å®Œæ•´çš„è§†é¢‘å¤„ç†æµç¨‹ã€‚

## ğŸ“‹ èƒŒæ™¯æ›¿æ¢æµç¨‹

### **å®Œæ•´å¤„ç†æµç¨‹**ï¼š
```
Viggleè¾“å‡º â†’ è¶…åˆ†å¤„ç† â†’ æŠ åƒå¤„ç† â†’ èƒŒæ™¯æ›¿æ¢ â†’ æœ€ç»ˆæˆå“
     â†“           â†“         â†“         â†“         â†“
   åŸå§‹è§†é¢‘    é«˜æ¸…è§†é¢‘   äººç‰©æŠ åƒ   æ–°èƒŒæ™¯    å®Œæ•´è§†é¢‘
```

### **èƒŒæ™¯æ›¿æ¢æ­¥éª¤**ï¼š
1. **è¾“å…¥**ï¼šæŠ åƒåçš„äººç‰©è§†é¢‘ï¼ˆå¸¦alphaé€šé“ï¼‰
2. **èƒŒæ™¯é€‰æ‹©**ï¼šæ™ºèƒ½é€‰æ‹©æˆ–æŒ‡å®šèƒŒæ™¯è§†é¢‘
3. **åˆæˆå¤„ç†**ï¼šå°†äººç‰©å åŠ åˆ°æ–°èƒŒæ™¯ä¸Š
4. **éŸ³è½¨ä¿ç•™**ï¼šä¿æŒåŸå§‹éŸ³è½¨
5. **è¾“å‡º**ï¼šæœ€ç»ˆæˆå“è§†é¢‘

## ğŸ¯ èƒŒæ™¯ç±»åˆ«ç³»ç»Ÿ

### **æ”¯æŒçš„èƒŒæ™¯ç±»åˆ«**ï¼š

| ç±»åˆ« | å…³é”®è¯ | é€‚ç”¨åœºæ™¯ | ç¤ºä¾‹èƒŒæ™¯ |
|------|--------|----------|----------|
| **dance** | dance, studio | èˆè¹ˆæ•™å­¦ã€è¡¨æ¼” | èˆè¹ˆå®¤ã€ç»ƒä¹ å®¤ |
| **gym** | gym, fitness | å¥èº«æ•™å­¦ã€è¿åŠ¨ | å¥èº«æˆ¿ã€å™¨æå®¤ |
| **stage** | stage, theater | æ­£å¼è¡¨æ¼”ã€æ¯”èµ› | èˆå°ã€å‰§åœº |
| **neutral** | neutral, simple | é€šç”¨èƒŒæ™¯ã€å•†åŠ¡ | çº¯è‰²ã€ç®€çº¦ |
| **gradient** | gradient, color | è‰ºæœ¯æ•ˆæœã€åˆ›æ„ | æ¸å˜ã€è‰²å½© |

### **èƒŒæ™¯æ–‡ä»¶å‘½åè§„èŒƒ**ï¼š
```
[ç±»åˆ«]_[æè¿°]_[åˆ†è¾¨ç‡].mp4

ç¤ºä¾‹ï¼š
dance_studio_white_1080p.mp4
gym_dark_modern_1080p.mp4
stage_red_curtain_1080p.mp4
neutral_black_simple_1080p.mp4
gradient_blue_purple_1080p.mp4
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### **1. å‘½ä»¤è¡Œä½¿ç”¨**

#### **æŸ¥çœ‹å¯ç”¨èƒŒæ™¯**ï¼š
```bash
python scripts/rtx3060_pipeline.py --list-backgrounds
```

#### **æŒ‡å®šèƒŒæ™¯ç±»åˆ«å¤„ç†**ï¼š
```bash
# ä½¿ç”¨èˆè¹ˆå®¤èƒŒæ™¯
python scripts/rtx3060_pipeline.py --background dance

# ä½¿ç”¨å¥èº«æˆ¿èƒŒæ™¯
python scripts/rtx3060_pipeline.py --background gym

# ä½¿ç”¨èˆå°èƒŒæ™¯
python scripts/rtx3060_pipeline.py --background stage

# ä½¿ç”¨ä¸­æ€§èƒŒæ™¯
python scripts/rtx3060_pipeline.py --background neutral

# ä½¿ç”¨æ¸å˜èƒŒæ™¯
python scripts/rtx3060_pipeline.py --background gradient
```

#### **éšæœºèƒŒæ™¯å¤„ç†**ï¼š
```bash
# ä¸æŒ‡å®šèƒŒæ™¯ç±»åˆ«ï¼Œéšæœºé€‰æ‹©
python scripts/rtx3060_pipeline.py
```

### **2. ç¼–ç¨‹æ¥å£ä½¿ç”¨**

#### **å•ä¸ªè§†é¢‘å¤„ç†**ï¼š
```python
from scripts.rtx3060_pipeline import RTX3060Pipeline, PipelineConfig

# åˆ›å»ºé…ç½®
config = PipelineConfig()
pipeline = RTX3060Pipeline(config)

# å¤„ç†å•ä¸ªè§†é¢‘ï¼ŒæŒ‡å®šèƒŒæ™¯ç±»åˆ«
success = pipeline.process_single_video(
    "input_video.mp4", 
    background_category="dance"
)
```

#### **æ‰¹é‡å¤„ç†**ï¼š
```python
# æ‰¹é‡å¤„ç†ï¼Œç»Ÿä¸€èƒŒæ™¯ç±»åˆ«
pipeline.run_batch_processing(background_category="gym")
```

### **3. ç‹¬ç«‹èƒŒæ™¯æ›¿æ¢å·¥å…·**

#### **ä½¿ç”¨èƒŒæ™¯æ›¿æ¢è„šæœ¬**ï¼š
```python
from scripts.background_replacement import BackgroundReplacer

# åˆ›å»ºèƒŒæ™¯æ›¿æ¢å™¨
replacer = BackgroundReplacer()

# å•ä¸ªè§†é¢‘èƒŒæ™¯æ›¿æ¢
success = replacer.replace_background(
    "input.mp4", 
    "output.mp4", 
    category="dance"
)

# æ‰¹é‡èƒŒæ™¯æ›¿æ¢
results = replacer.batch_replace_backgrounds(
    "input_dir", 
    "output_dir", 
    category="gym"
)
```

## âš™ï¸ æŠ€æœ¯å®ç°

### **FFmpegå‘½ä»¤ç¤ºä¾‹**ï¼š
```bash
# èƒŒæ™¯æ›¿æ¢çš„æ ¸å¿ƒå‘½ä»¤
ffmpeg -i person_alpha.mp4 -i background.mp4 \
  -filter_complex "[1:v]scale=1920:1080:force_original_aspect_ratio=decrease,pad=1920:1080:(ow-iw)/2:(oh-ih)/2[bg];[bg][0:v]overlay=0:0:format=auto" \
  -c:v libx264 -pix_fmt yuv420p -b:v 2M \
  -c:a aac -map 0:a? \
  output.mp4
```

### **å…³é”®å‚æ•°è¯´æ˜**ï¼š
- `scale=1920:1080`: è°ƒæ•´èƒŒæ™¯åˆ†è¾¨ç‡
- `force_original_aspect_ratio=decrease`: ä¿æŒå®½é«˜æ¯”
- `pad=1920:1080:(ow-iw)/2:(oh-ih)/2`: å±…ä¸­å¡«å……
- `overlay=0:0:format=auto`: äººç‰©å åŠ åˆ°èƒŒæ™¯
- `-map 0:a?`: ä¿ç•™åŸå§‹éŸ³è½¨

## ğŸ“ ç›®å½•ç»“æ„

### **èƒŒæ™¯åº“ç»„ç»‡**ï¼š
```
backgrounds/
â”œâ”€â”€ dance_studio/          # èˆè¹ˆå®¤èƒŒæ™¯
â”‚   â”œâ”€â”€ white_studio.mp4
â”‚   â”œâ”€â”€ wooden_floor.mp4
â”‚   â””â”€â”€ modern_studio.mp4
â”œâ”€â”€ gym/                   # å¥èº«æˆ¿èƒŒæ™¯
â”‚   â”œâ”€â”€ dark_gym.mp4
â”‚   â”œâ”€â”€ equipment_bg.mp4
â”‚   â””â”€â”€ mirror_wall.mp4
â”œâ”€â”€ stage/                 # èˆå°èƒŒæ™¯
â”‚   â”œâ”€â”€ theater_stage.mp4
â”‚   â”œâ”€â”€ concert_hall.mp4
â”‚   â””â”€â”€ red_curtain.mp4
â”œâ”€â”€ neutral/               # ä¸­æ€§èƒŒæ™¯
â”‚   â”œâ”€â”€ white_bg.mp4
â”‚   â”œâ”€â”€ gray_bg.mp4
â”‚   â””â”€â”€ black_bg.mp4
â””â”€â”€ gradients/             # æ¸å˜èƒŒæ™¯
    â”œâ”€â”€ blue_purple.mp4
    â”œâ”€â”€ orange_red.mp4
    â””â”€â”€ green_blue.mp4
```

## ğŸ¨ èƒŒæ™¯é€‰æ‹©ç­–ç•¥

### **æ™ºèƒ½é€‰æ‹©é€»è¾‘**ï¼š
1. **æŒ‡å®šç±»åˆ«**ï¼šä¼˜å…ˆé€‰æ‹©æŒ‡å®šç±»åˆ«çš„èƒŒæ™¯
2. **å…³é”®è¯åŒ¹é…**ï¼šæ ¹æ®æ–‡ä»¶åå…³é”®è¯åŒ¹é…
3. **éšæœºé€‰æ‹©**ï¼šå¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œéšæœºé€‰æ‹©
4. **é»˜è®¤èƒŒæ™¯**ï¼šå¦‚æœæ²¡æœ‰ä»»ä½•èƒŒæ™¯ï¼Œåˆ›å»ºçº¯è‰²èƒŒæ™¯

### **èƒŒæ™¯åŒ¹é…è§„åˆ™**ï¼š
```python
category_patterns = {
    "dance": ["dance", "studio"],
    "gym": ["gym", "fitness"],
    "stage": ["stage", "theater"],
    "neutral": ["neutral", "simple"],
    "gradient": ["gradient", "color"]
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### **1. èƒŒæ™¯é€‰æ‹©å»ºè®®**ï¼š
- **èˆè¹ˆè§†é¢‘**ï¼šé€‰æ‹©èˆè¹ˆå®¤æˆ–èˆå°èƒŒæ™¯
- **å¥èº«è§†é¢‘**ï¼šé€‰æ‹©å¥èº«æˆ¿èƒŒæ™¯
- **æ•™å­¦è§†é¢‘**ï¼šé€‰æ‹©ä¸­æ€§èƒŒæ™¯
- **åˆ›æ„è§†é¢‘**ï¼šé€‰æ‹©æ¸å˜èƒŒæ™¯

### **2. éŸ³è½¨å¤„ç†**ï¼š
- âœ… è‡ªåŠ¨ä¿ç•™åŸå§‹éŸ³è½¨
- âœ… ç¡®ä¿éŸ³è§†é¢‘åŒæ­¥
- âœ… ä¿æŒéŸ³é¢‘è´¨é‡

### **3. è´¨é‡ä¼˜åŒ–**ï¼š
- ä½¿ç”¨é«˜è´¨é‡èƒŒæ™¯ç´ æ
- ç¡®ä¿èƒŒæ™¯åˆ†è¾¨ç‡è¶³å¤Ÿ
- æ³¨æ„äººç‰©ä¸èƒŒæ™¯çš„åè°ƒæ€§

### **4. æ€§èƒ½ä¼˜åŒ–**ï¼š
- èƒŒæ™¯æ–‡ä»¶å¤§å°æ§åˆ¶åœ¨åˆç†èŒƒå›´
- ä½¿ç”¨GPUåŠ é€Ÿå¤„ç†
- å¹¶è¡Œå¤„ç†å¤šä¸ªè§†é¢‘

## ğŸ”§ æ•…éšœæ’é™¤

### **å¸¸è§é—®é¢˜**ï¼š

#### **1. èƒŒæ™¯æ–‡ä»¶ä¸å­˜åœ¨**ï¼š
```
é”™è¯¯ï¼šèƒŒæ™¯æ–‡ä»¶ä¸å­˜åœ¨
è§£å†³ï¼šæ£€æŸ¥backgroundsç›®å½•ï¼Œç¡®ä¿æœ‰èƒŒæ™¯æ–‡ä»¶
```

#### **2. éŸ³è½¨ä¸¢å¤±**ï¼š
```
é”™è¯¯ï¼šè¾“å‡ºè§†é¢‘æ²¡æœ‰éŸ³è½¨
è§£å†³ï¼šæ£€æŸ¥è¾“å…¥è§†é¢‘æ˜¯å¦æœ‰éŸ³è½¨ï¼Œç¡®ä¿FFmpegå‘½ä»¤æ­£ç¡®
```

#### **3. èƒŒæ™¯æ˜¾ç¤ºå¼‚å¸¸**ï¼š
```
é”™è¯¯ï¼šèƒŒæ™¯æ˜¾ç¤ºä¸æ­£ç¡®
è§£å†³ï¼šæ£€æŸ¥èƒŒæ™¯æ–‡ä»¶æ ¼å¼ï¼Œç¡®ä¿åˆ†è¾¨ç‡åŒ¹é…
```

### **è°ƒè¯•æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥èƒŒæ™¯æ–‡ä»¶ä¿¡æ¯
ffprobe -v quiet -print_format json -show_streams background.mp4

# æ£€æŸ¥è¾“å…¥è§†é¢‘ä¿¡æ¯
ffprobe -v quiet -print_format json -show_streams input.mp4

# æµ‹è¯•èƒŒæ™¯æ›¿æ¢
ffmpeg -i input.mp4 -i background.mp4 -filter_complex "overlay=0:0" -y test_output.mp4
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### **å¤„ç†æ—¶é—´**ï¼ˆåŸºäº3060 12GBï¼‰ï¼š
| è§†é¢‘æ—¶é•¿ | èƒŒæ™¯æ›¿æ¢æ—¶é—´ | æ€»å¤„ç†æ—¶é—´ |
|----------|-------------|------------|
| 1åˆ†é’Ÿ    | 0.2åˆ†é’Ÿ     | 1.7åˆ†é’Ÿ    |
| 3åˆ†é’Ÿ    | 0.5åˆ†é’Ÿ     | 4åˆ†é’Ÿ      |
| 5åˆ†é’Ÿ    | 1åˆ†é’Ÿ       | 7åˆ†é’Ÿ      |

### **è´¨é‡æŒ‡æ ‡**ï¼š
- **åˆ†è¾¨ç‡**ï¼š1920x1080
- **å¸§ç‡**ï¼š30fps
- **ç¼–ç **ï¼šH.264
- **éŸ³é¢‘**ï¼šAAC
- **éŸ³è½¨ä¿ç•™**ï¼š100%

é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œæ‚¨å¯ä»¥è½»æ¾å®ç°Pipelineä¸­çš„èƒŒæ™¯æ›¿æ¢åŠŸèƒ½ï¼Œä¸ºèˆè¹ˆè§†é¢‘æ·»åŠ ä¸“ä¸šçš„èƒŒæ™¯æ•ˆæœï¼ğŸ¨
